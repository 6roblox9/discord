(()=>{
"use strict";var $=(()=>{var __create=Object.create;var __defProp=Object.defineProperty;var __getOwnPropDesc=Object.getOwnPropertyDescriptor;var __getOwnPropNames=Object.getOwnPropertyNames;var __getProtoOf=Object.getPrototypeOf,__hasOwnProp=Object.prototype.hasOwnProperty;var __esm=(fn,res)=>function(){return fn&&(res=(0,fn[__getOwnPropNames(fn)[0]])(fn=0)),res};var __commonJS=(cb,mod)=>function(){return mod||(0,cb[__getOwnPropNames(cb)[0]])((mod={exports:{}}).exports,mod),mod.exports};var __export=(target,all)=>{for(var name in all)__defProp(target,name,{get:all[name],enumerable:!0})},__copyProps=(to,from,except,desc)=>{if(from&&typeof from=="object"||typeof from=="function")for(var keys=__getOwnPropNames(from),i=0,n=keys.length,key;i<n;i++)key=keys[i],!__hasOwnProp.call(to,key)&&key!==except&&__defProp(to,key,{get:(k=>from[k]).bind(null,key),enumerable:!(desc=__getOwnPropDesc(from,key))||desc.enumerable});return to};var __toESM=(mod,isNodeMode,target)=>(target=mod!=null?__create(__getProtoOf(mod)):{},__copyProps(isNodeMode||!mod||!mod.__esModule?__defProp(target,"default",{value:mod,enumerable:!0}):target,mod)),__toCommonJS=mod=>__copyProps(__defProp({},"__esModule",{value:!0}),mod);var define_PLUGINS_LIST_default,init_define_PLUGINS_LIST=__esm({"<define:PLUGINS_LIST>"(){define_PLUGINS_LIST_default=["app-directory","char-counter","clean-urls","cloud-sync","customrpc","doom","kiryu-facecam","local-pins","message-preview","monet-theme","nexxutils","plugin-browser","plugin-embeds","song-spotlight","tenor-gif-fix","themes-plus","twemoji-everywhere","use-system-emoji","userpfp"]}});var require_common=__commonJS({"vendetta:@vendetta/metro/common"(exports,module){init_define_PLUGINS_LIST();init_migration_shim();module.exports=vendetta.metro.common}});var require_plugins=__commonJS({"vendetta:@vendetta/plugins"(exports,module){init_define_PLUGINS_LIST();init_migration_shim();module.exports=vendetta.plugins}});var require_storage=__commonJS({"vendetta:@vendetta/storage"(exports,module){init_define_PLUGINS_LIST();init_migration_shim();module.exports=vendetta.storage}});var require_alerts=__commonJS({"vendetta:@vendetta/ui/alerts"(exports,module){init_define_PLUGINS_LIST();init_migration_shim();module.exports=vendetta.ui.alerts}});var require_assets=__commonJS({"vendetta:@vendetta/ui/assets"(exports,module){init_define_PLUGINS_LIST();init_migration_shim();module.exports=vendetta.ui.assets}});var require_toasts=__commonJS({"vendetta:@vendetta/ui/toasts"(exports,module){init_define_PLUGINS_LIST();init_migration_shim();module.exports=vendetta.ui.toasts}});var require_metro=__commonJS({"vendetta:@vendetta/metro"(exports,module){init_define_PLUGINS_LIST();init_migration_shim();module.exports=vendetta.metro}});var require_ui=__commonJS({"vendetta:@vendetta/ui"(exports,module){init_define_PLUGINS_LIST();init_migration_shim();module.exports=vendetta.ui}});var require_patcher=__commonJS({"vendetta:@vendetta/patcher"(exports,module){init_define_PLUGINS_LIST();init_migration_shim();module.exports=vendetta.patcher}});function getNativeModule(...names){for(var name of names){if(globalThis.__turboModuleProxy){var module=globalThis.__turboModuleProxy(name);if(module)return module}if(nmp[name])return nmp[name]}}var import_metro,import_common,WebView,Svg,Reanimated,FlashList,Joi,zustand,zustandMW,DocumentPicker,DocumentsNew,_MAS,nmp,RNCacheModule,RNChatModule,RNFileModule,init_deps=__esm({"src/stuff/deps.ts"(){"use strict";init_define_PLUGINS_LIST();init_migration_shim();import_metro=__toESM(require_metro(),1),import_common=__toESM(require_common(),1),WebView=(0,import_metro.find)(x=>x?.WebView&&!x.default).WebView,Svg=(0,import_metro.findByProps)("SvgXml"),Reanimated=(0,import_metro.findByProps)("useSharedValue"),FlashList=(0,import_metro.findByProps)("FlashList").FlashList,Joi=(0,import_metro.findByProps)("isJoi"),zustand=(0,import_metro.findByProps)("create","useStore")||{create:(0,import_metro.findByName)("create")},zustandMW=(0,import_metro.findByProps)("createJSONStorage","persist"),DocumentPicker=(0,import_metro.findByProps)("pickSingle","isCancel"),DocumentsNew=(0,import_metro.findByProps)("pick","saveDocuments"),_MAS=(0,import_metro.findByProps)("MobileAudioSound").MobileAudioSound,nmp=window.nativeModuleProxy;RNCacheModule=getNativeModule("NativeCacheModule","MMKVManager"),RNChatModule=getNativeModule("NativeChatModule","DCDChatManager"),RNFileModule=getNativeModule("NativeFileModule","DCDFileManager")}});function resolveSemanticColor(color,theme=ThemeStore.theme){return color&&colorResolver?.resolveSemanticColor(theme,color)||"#000000"}function patchRows(callback){return(0,import_patcher.before)("updateRows",RNChatModule,args=>{var rows=JSON.parse(args[1]);try{callback(rows)}catch(e){console.error("[nexpid.patchRows]",e)}args[1]=JSON.stringify(rows)})}var import_metro2,import_common2,import_assets,import_toasts,import_patcher,ThemeStore,triggerHaptic,colorModule,colorResolver,useThemeContext,TextStyleSheet,Navigator,modalCloseButton,popModal,pushModal,init_types=__esm({"src/stuff/types.tsx"(){"use strict";init_define_PLUGINS_LIST();init_migration_shim();import_metro2=__toESM(require_metro(),1),import_common2=__toESM(require_common(),1),import_assets=__toESM(require_assets(),1),import_toasts=__toESM(require_toasts(),1),import_patcher=__toESM(require_patcher(),1);init_deps();ThemeStore=(0,import_metro2.findByStoreName)("ThemeStore"),{triggerHaptic}=(0,import_metro2.findByProps)("triggerHaptic"),colorModule=(0,import_metro2.findByProps)("colors","unsafe_rawColors"),colorResolver=colorModule?.internal??colorModule?.meta,{useThemeContext}=(0,import_metro2.findByProps)("useThemeContext"),TextStyleSheet=(0,import_metro2.findByProps)("TextStyleSheet").TextStyleSheet,Navigator=(0,import_metro2.findByProps)("Navigator")?.Navigator,modalCloseButton=(0,import_metro2.findByProps)("getHeaderCloseButton")?.getHeaderCloseButton,{popModal,pushModal}=(0,import_metro2.findByProps)("popModal","pushModal")}});function Text({variant,lineClamp,color,align,style,onPress,getChildren,children,liveUpdate,ellipsis}){var themeContext=useThemeContext2(),[_,forceUpdate]=import_common3.React.useReducer(x=>~x,0);return import_common3.React.useEffect(()=>{if(liveUpdate){var nextSecond=()=>Date.now()-new Date().setMilliseconds(1e3),timeout=setTimeout(function update(){forceUpdate(),timeout=setTimeout(update,nextSecond())},nextSecond());return()=>clearTimeout(timeout)}},[]),import_common3.React.createElement(import_common3.ReactNative.Text,{style:[variant&&TextStyleSheet[variant],color?{color:resolveSemanticColor(import_ui.semanticColors[color],themeContext?.theme)}:{},align&&{textAlign:align},style??{}],numberOfLines:lineClamp,onPress,ellipsizeMode:ellipsis},getChildren?.()??children)}var import_metro3,import_common3,import_ui,useThemeContext2,init_Text=__esm({"src/stuff/components/Text.tsx"(){"use strict";init_define_PLUGINS_LIST();init_migration_shim();import_metro3=__toESM(require_metro(),1),import_common3=__toESM(require_common(),1),import_ui=__toESM(require_ui(),1);init_types();({useThemeContext:useThemeContext2}=(0,import_metro3.findByProps)("useThemeContext"))}});var import_common4,RichText,init_RichText=__esm({"src/stuff/components/RichText.tsx"(){"use strict";init_define_PLUGINS_LIST();init_migration_shim();import_common4=__toESM(require_common(),1);init_Text();(function(RichText2){function Bold({children,onPress}){return React.createElement(Text,{variant:"text-md/bold",onPress},children)}RichText2.Bold=Bold;function Underline({children,onPress}){return React.createElement(import_common4.ReactNative.Text,{style:{textDecorationLine:"underline"},onPress},children)}RichText2.Underline=Underline})(RichText||(RichText={}))}});var import_metro4,import_common5,import_toasts2,NotFound,findProp,findPropPolyfill,Button,RowButton,FloatingActionButton,PressableScale,IconButton,ContextMenu,_Slider,TextInput,Tabs,SegmentedControlPages,Card,Stack,useSegmentedControlState,init_redesign=__esm({"src/stuff/lib/redesign/index.tsx"(){"use strict";init_define_PLUGINS_LIST();init_migration_shim();import_metro4=__toESM(require_metro(),1),import_common5=__toESM(require_common(),1),import_toasts2=__toESM(require_toasts(),1),NotFound=(prop,isFunction)=>()=>{var trigger=()=>{(0,import_toasts2.showToast)(`${prop} not found! Search for PNF in Debug Logs!`),console.warn(`!! PNF ERROR !!
Missing the redesign ${isFunction?"function":"component"}: ${prop}. Please bug @nexpid about this on Discord!`)};return isFunction?trigger():import_common5.React.useEffect(trigger,[]),null},findProp=(...props)=>(0,import_metro4.findByProps)(...props)?.[props[0]],findPropPolyfill=(isFunction,...props)=>findProp(...props)??NotFound(props[0],isFunction),Button=findPropPolyfill(!1,"Button"),RowButton=findPropPolyfill(!1,"RowButton"),FloatingActionButton=findPropPolyfill(!1,"FloatingActionButton"),PressableScale=findPropPolyfill(!1,"PressableScale"),IconButton=findPropPolyfill(!1,"IconButton"),ContextMenu=findPropPolyfill(!1,"ContextMenu"),_Slider=findPropPolyfill(!1,"Slider"),TextInput=findPropPolyfill(!1,"TextInput"),Tabs=findPropPolyfill(!1,"Tabs"),SegmentedControlPages=findPropPolyfill(!1,"SegmentedControlPages"),Card=findPropPolyfill(!1,"Card"),Stack=findPropPolyfill(!1,"Stack"),useSegmentedControlState=findPropPolyfill(!0,"useSegmentedControlState")}});function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){reject(error);return}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _async_to_generator(fn){return function(){var self=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)})}}function MigrationModal({affectedPlugin,domains}){var jumper=Reanimated.useSharedValue(0),spinner=Reanimated.useSharedValue("0deg"),squisherX=Reanimated.useSharedValue(1),squisherY=Reanimated.useSharedValue(1),[toggle,setToggle]=import_common6.React.useState(!0),duration=300,fromY=-10,toY=30,spinBetween=11,squishConfig={duration:0},squishVal=1.25,releaseConfig={duration:duration*2,easing:Reanimated.Easing.out(Reanimated.Easing.quad)},releaseVal=.9;return import_common6.React.useEffect(()=>{if(!toggle){jumper.value=0,spinner.value="0deg",squisherX.value=1,squisherY.value=1;return}jumper.value=Reanimated.withRepeat(Reanimated.withSequence(Reanimated.withTiming(toY,{easing:Reanimated.Easing.out(Reanimated.Easing.quad),duration}),Reanimated.withTiming(fromY,{easing:Reanimated.Easing.quad,duration})),-1),spinner.value=Reanimated.withRepeat(Reanimated.withSequence(Reanimated.withTiming("0deg",{duration:duration*2*spinBetween}),Reanimated.withTiming("-360deg",{duration:duration*2,easing:Reanimated.Easing.out(Reanimated.Easing.exp)})),-1),squisherX.value=Reanimated.withRepeat(Reanimated.withSequence(Reanimated.withTiming(squishVal,squishConfig),Reanimated.withTiming(releaseVal,releaseConfig)),-1),squisherY.value=Reanimated.withRepeat(Reanimated.withSequence(Reanimated.withTiming(1/squishVal,squishConfig),Reanimated.withTiming(1/releaseVal,releaseConfig)),-1)},[toggle]),import_common6.React.createElement(Stack,{direction:"vertical",spacing:8},import_common6.React.createElement(Stack,{direction:"horizontal",spacing:14,style:{justifyContent:"center",alignItems:"center",marginBottom:18,marginHorizontal:8}},import_common6.React.createElement(Pressable,{style:{width:80,height:80},pointerEvents:"box-only",onPress:()=>setToggle(!toggle),accessibilityRole:"togglebutton",accessibilityLabel:"toggle jumping animation"},import_common6.React.createElement(Reanimated.default.Image,{source:{uri:"https://api.lanyard.rest/853550207039832084.webp?size=128",width:128,height:128},style:[{borderRadius:40,width:80,height:80,position:"absolute",bottom:0},{bottom:jumper,transform:[{scaleX:squisherX},{scaleY:squisherY},{rotate:spinner}]}]})),import_common6.React.createElement(Stack,{direction:"vertical",style:{flex:1}},import_common6.React.createElement(Text,{variant:"heading-xl/extrabold",color:"TEXT_DEFAULT",style:{flex:0}},"Hey, it's me, nexpid!"),import_common6.React.createElement(Text,{variant:"heading-md/medium",color:"TEXT_DEFAULT",style:{flex:0}},"You might know me. I made ",affectedPlugin?import_common6.React.createElement(import_common6.React.Fragment,null,"a plugin you use, ",import_common6.React.createElement(RichText.Bold,null,affectedPlugin)):"some of the plugins you use","!"))),import_common6.React.createElement(Text,{variant:"text-md/medium",color:"TEXT_DEFAULT"},affectedPlugin?"The plugin you use has":"Some of my plugins you use have"," one of these domains:"),import_common6.React.createElement(Text,{variant:"text-md/bold",color:"TEXT_DEFAULT",style:{marginHorizontal:10}},domains.map(label=>`\u2022 ${label}`).join(`
`)),import_common6.React.createElement(Text,{variant:"text-md/medium",color:"TEXT_DEFAULT"},"These domains are being deprecated and plugins on them won't receive any new updates. Please use the new domain instead:"),import_common6.React.createElement(Text,{variant:"text-lg/bold",color:"TEXT_DEFAULT",style:{textDecorationLine:"underline"},align:"center"},"revenge.nexpid.xyz"))}function runMigration(){return _runMigration.apply(this,arguments)}function _runMigration(){return _runMigration=_async_to_generator(function*(){var _loop=function(plugin2){var parser=invalidDomains.find(x=>x.match.test(plugin2)),id=parser&&plugin2.match(parser.match)?.groups?.plugin;id&&allowedPluginIDs.includes(id)&&(affected.push({id,link:plugin2,name:import_plugins.plugins[plugin2].manifest.name}),isOutdated.add(parser.label),plugin2.includes("bn-plugins.github.io/vd-proxy")&&isOutdated.add("proxied plugin links"))};if(!(yield RNFileModule.fileExists(`${RNFileModule.DocumentsDirPath}/${migrationLockFilePath}`))){var affected=[],isOutdated=new Set;for(var plugin of Object.keys(import_plugins.plugins))_loop(plugin);isOutdated.size&&(0,import_alerts.showConfirmationAlert)({children:import_common6.React.createElement(MigrationModal,{affectedPlugin:affected.length===1?affected[0].name:void 0,domains:[...isOutdated.values()]}),confirmText:"Migrate now",onConfirm(){return _async_to_generator(function*(){(0,import_toasts3.showToast)("Starting migration"),console.log("MIGRATION STARTS HERE, AFFECTED",affected);try{for(var{id,link,name}of affected){var newPlugin=`https://revenge.nexpid.xyz/${specialIDs[id]??id}/`;console.log("FROM",link,"TO",newPlugin),yield(0,import_storage.createMMKVBackend)(newPlugin).set(yield(0,import_storage.createMMKVBackend)(link).get()),import_plugins.plugins[newPlugin]||(yield(0,import_plugins.installPlugin)(newPlugin)),yield(0,import_plugins.removePlugin)(link),(0,import_toasts3.showToast)(`Migrated ${name}`)}console.log("MIGRATION ENDS HERE")}catch(e){return console.error("Migration error",e),(0,import_toasts3.showToast)(`Got an error! ${e} (ping nexpid about this!!!)`,(0,import_assets2.getAssetIDByName)("CircleXIcon-primary"))}(0,import_toasts3.showToast)("Migrated successfully! Please reload your client to apply changes",(0,import_assets2.getAssetIDByName)("CircleCheckIcon-primary"))})()},cancelText:"Remind me later",secondaryConfirmText:"I understand (don't show again)",onConfirmSecondary(){RNFileModule.writeFile("documents",migrationLockFilePath,"revenged","utf8")}})}}),_runMigration.apply(this,arguments)}var import_common6,import_plugins,import_storage,import_alerts,import_assets2,import_toasts3,Pressable,specialIDs,allowedPluginIDs,invalidDomains,migrationLockFilePath,init_migration=__esm({"src/stuff/migration.tsx"(){"use strict";init_define_PLUGINS_LIST();init_migration_shim();import_common6=__toESM(require_common(),1),import_plugins=__toESM(require_plugins(),1),import_storage=__toESM(require_storage(),1),import_alerts=__toESM(require_alerts(),1),import_assets2=__toESM(require_assets(),1),import_toasts3=__toESM(require_toasts(),1);init_RichText();init_Text();init_deps();init_redesign();({Pressable}=import_common6.ReactNative),specialIDs={usrpfp:"userpfp"},allowedPluginIDs=[define_PLUGINS_LIST_default,Object.keys(specialIDs)].flat(),invalidDomains=[{match:RegExp("vendetta\\.nexpid\\.xyz\\/(?<plugin>.+)\\/$","i"),label:"vendetta.nexpid.xyz"},{match:RegExp("dev\\.bunny\\.nexpid\\.xyz\\/(?<plugin>.+)\\/$","i"),label:"dev.bunny.nexpid.xyz"},{match:RegExp("bunny\\.nexpid\\.xyz\\/(?<plugin>.+)\\/$","i"),label:"bunny.nexpid.xyz"}],migrationLockFilePath="nexpid/revengemigration.txt"}});var symbol,init_migration_shim=__esm({"scripts/build/modules/workers/migration-shim.ts"(){"use strict";init_migration();symbol=Symbol.for("nexpid revenge migration");window[symbol]||(window[symbol]=!0,runMigration())}});var src_exports={};__export(src_exports,{onUnload:()=>onUnload});init_define_PLUGINS_LIST();init_migration_shim();init_types();function iterate(rows){var content=[],header;for(var original of rows){var row=original;row.type==="emoji"&&(row={type:"text",content:row.surrogate}),"content"in row&&Array.isArray(row.content)&&(row.content=iterate(row.content)),"items"in row&&Array.isArray(row.items)&&(row.items=iterate(row.items)),"jumboable"in original&&original.jumboable&&!header&&(header={type:"heading",level:1,content:[]}),(original.type==="emoji"||original.type==="customEmoji")&&!original.jumboable&&header&&(content.push(header),header=void 0),header?header.content.push(row):content.push(row)}return header&&content.push(header),content}var onUnload=patchRows(rows=>{for(var row of rows)row.type===1&&row.message.content&&(row.message.content=iterate(row.message.content))});return __toCommonJS(src_exports);})();
return $;})();
