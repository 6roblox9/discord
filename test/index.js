(function(h,o,C,c,e,n,M){"use strict";const{ScrollView:_}=o.findByProps("ScrollView"),{TableRowGroup:w,TableSwitchRow:l,Stack:$}=o.findByProps("TableSwitchRow","TableRowGroup","Stack");e.storage.trackFriends??=!0,e.storage.trackMessages??=!0,e.storage.trackTyping??=!0,e.storage.trackProfile??=!0,e.storage.trackVoice??=!0,e.storage.watchDM??=!0,e.storage.watchGroup??=!0,e.storage.watchServers??=!0;function G(){return M.useProxy(e.storage),n.React.createElement(_,{style:{flex:1},contentContainerStyle:{padding:10}},n.React.createElement($,{spacing:8},n.React.createElement(w,{title:"Tracking Events"},n.React.createElement(l,{label:"Track Profile Changes",value:e.storage.trackProfile,onValueChange:function(t){return e.storage.trackProfile=t}}),n.React.createElement(l,{label:"Track Started Typing",value:e.storage.trackTyping,onValueChange:function(t){return e.storage.trackTyping=t}}),n.React.createElement(l,{label:"Track Sent Message",value:e.storage.trackMessages,onValueChange:function(t){return e.storage.trackMessages=t}}),n.React.createElement(l,{label:"Track Voice Join",value:e.storage.trackVoice,onValueChange:function(t){return e.storage.trackVoice=t}})),n.React.createElement(w,{title:"Channel Scope"},n.React.createElement(l,{label:"DM",value:e.storage.watchDM,onValueChange:function(t){return e.storage.watchDM=t}}),n.React.createElement(l,{label:"Group DM",value:e.storage.watchGroup,onValueChange:function(t){return e.storage.watchGroup=t}}),n.React.createElement(l,{label:"Servers",value:e.storage.watchServers,onValueChange:function(t){return e.storage.watchServers=t}})),n.React.createElement(w,{title:"Users"},n.React.createElement(l,{label:"Track Friends",value:e.storage.trackFriends,onValueChange:function(t){return e.storage.trackFriends=t}}))))}const T=o.findByProps("dispatch","subscribe"),D=o.findByProps("getStatus"),I=o.findByProps("getFriendIDs"),k=o.findByProps("getChannel"),S=o.findByProps("getGuild"),R=o.findByProps("getUser"),F=o.findByProps("getVoiceStateForUser");e.storage.trackFriends??=!0,e.storage.userIds??=[],e.storage.trackMessages??=!0,e.storage.trackTyping??=!0,e.storage.trackProfile??=!0,e.storage.trackVoice??=!0,e.storage.watchDM??=!0,e.storage.watchGroup??=!0,e.storage.watchServers??=!0;const y={},v={},u=function(){const t=new Set;if(e.storage.trackFriends)for(const g of I.getFriendIDs())t.add(g);for(const g of e.storage.userIds)t.add(g);return[...t]},i=function(t){return R.getlegateUser?.(t)?.username??R.getUser(t)?.username??t},E=function(t){return t?t.guild_id?e.storage.watchServers:t.type===3?e.storage.watchGroup:e.storage.watchDM:!1};let b=null,V=null;var B={onLoad(){for(const a of u())y[a]=D.getStatus(a),v[a]=F.getVoiceStateForUser?.(a)?.channelId??null;b=C.after("dispatch",T,function([a]){if(a?.type==="PRESENCE_UPDATE"&&e.storage.trackProfile){const s=a.user?.id;if(!u().includes(s))return;y[s]!==a.status&&(y[s]=a.status,c.showToast(`${i(s)} is now ${a.status}`))}if(a?.type==="VOICE_STATE_UPDATES"&&e.storage.trackVoice)for(const s of a.voiceStates??[]){const r=s.userId;if(!u().includes(r))continue;const d=v[r],f=s.channelId??null;if(!d&&f){const P=k.getChannel(f);if(!E(P))continue;if(P.guild_id){const U=S.getGuild(P.guild_id);c.showToast(`${i(r)} joined voice in ${U?.name}`)}else c.showToast(`${i(r)} joined voice call`)}v[r]=f}});const t=function(a){if(!e.storage.trackMessages)return;const s=a?.message,r=s?.author?.id;if(!u().includes(r))return;const d=k.getChannel(s.channel_id);if(E(d))if(d.guild_id){const f=S.getGuild(d.guild_id);c.showToast(`${i(r)} messaged in ${f?.name} #${d.name}`)}else d.type===3?c.showToast(`${i(r)} messaged in group`):c.showToast(`${i(r)} messaged in DM`)},g=function(a){if(!e.storage.trackTyping)return;const s=a?.userId;if(!u().includes(s))return;const r=k.getChannel(a.channelId);if(E(r))if(r.guild_id){const d=S.getGuild(r.guild_id);c.showToast(`${i(s)} typing in ${d?.name} #${r.name}`)}else r.type===3?c.showToast(`${i(s)} typing in group`):c.showToast(`${i(s)} typing in DM`)};T.subscribe("MESSAGE_CREATE",t),T.subscribe("TYPING_START",g),V=function(){}},onUnload(){b?.(),V?.()},settings:G};return h.default=B,Object.defineProperty(h,"__esModule",{value:!0}),h})({},vendetta.metro,vendetta.patcher,vendetta.ui.toasts,vendetta.plugin,vendetta.metro.common,vendetta.storage);
