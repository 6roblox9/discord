(function(_,m,r){"use strict";const d=[];let f=[];function R(e){return f.push(e),function(){f=f.filter(function(t){return t!==e})}}function i(e,t){const a=new Date().toLocaleTimeString();d.push({id:Math.random().toString(36).substring(7),color:e,text:t,time:a}),f.forEach(function(n){return n()})}function k(){d.length=0,f.forEach(function(e){return e()})}function S(){const[e,t]=r.React.useReducer(function(n){return n+1},0);r.React.useEffect(function(){return R(function(){return t()})},[]);const a=function(n){switch(n){case"G":return"#43b581";case"Y":return"#faa61a";case"C":return"#00b0f4";default:return"#dcddde"}};return r.React.createElement(r.ReactNative.ScrollView,{style:{flex:1,backgroundColor:"#202225",padding:12}},r.React.createElement(r.ReactNative.View,{style:{marginBottom:16}},r.React.createElement(r.ReactNative.Text,{style:{color:"#fff",fontSize:18,fontWeight:"bold",marginBottom:8}},"Quest Auto-Solver Logs")),r.React.createElement(r.ReactNative.View,{style:{backgroundColor:"#2f3136",borderRadius:8,padding:12,minHeight:200}},d.length===0?r.React.createElement(r.ReactNative.Text,{style:{color:"#72767d",fontStyle:"italic",textAlign:"center",marginTop:20}},"Waiting for activity..."):d.map(function(n){return r.React.createElement(r.ReactNative.Text,{key:n.id,style:{fontFamily:"monospace",fontSize:12,marginBottom:2}},r.React.createElement(r.ReactNative.Text,{style:{color:"#72767d"}},"[",n.time,"] "),r.React.createElement(r.ReactNative.Text,{style:{color:a(n.color)}},n.text))})),r.React.createElement(r.ReactNative.View,{style:{height:20}}))}const{getToken:w}=m.findByProps("getToken");let c=!1;const y="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) discord/1.0.9215 Chrome/138.0.7204.251 Electron/37.6.0 Safari/537.36";function x(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const t=Math.random()*16|0;return(e==="x"?t:t&3|8).toString(16)})}const T={os:"Windows",browser:"Discord Client",release_channel:"stable",client_version:"1.0.9215",os_version:"10.0.19045",os_arch:"x64",app_arch:"x64",system_locale:"en-US",has_client_mods:!1,client_launch_id:x(),browser_user_agent:y,browser_version:"37.6.0",os_sdk_version:"19045",client_build_number:471091,native_build_number:72186,client_event_source:null,launch_signature:x(),client_heartbeat_session_id:x(),client_app_state:"focused"},g=function(e){return new Promise(function(t){return setTimeout(t,e)})};function $(e){const t=JSON.stringify(e),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let n="";for(let o=0,s,u=0,l=a;t.charAt(u|0)||(l="=",u%1);n+=l.charAt(63&o>>8-u%1*8)){if(s=t.charCodeAt(u+=3/4),s>255)throw new Error("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");o=o<<8|s}return n}function h(e=!1){const t={Authorization:w(),"User-Agent":y,"x-super-properties":$(T)};return e&&(t["Content-Type"]="application/json"),t}async function p(e,t=5){for(let a=0;a<t;a++){if(c)return null;try{return await e()}catch{await g(3e3)}}throw new Error("Request failed after retries")}async function v(){const e=await p(function(){return fetch("https://discord.com/api/v10/quests/@me",{headers:h()})});return e?e.json():{quests:[]}}async function E(e){await p(function(){return fetch(`https://discord.com/api/v10/quests/${e}/enroll`,{method:"POST",headers:h(!0),body:JSON.stringify({location:11,is_targeted:!1,metadata_raw:null})})})}async function N(e,t){const a=await p(function(){return fetch(`https://discord.com/api/v10/quests/${e}/video-progress`,{method:"POST",headers:h(!0),body:JSON.stringify({timestamp:t})})});return a?a.json():{}}async function b(e,t,a){const n=await p(function(){return fetch(`https://discord.com/api/v10/quests/${e}/heartbeat`,{method:"POST",headers:h(!0),body:JSON.stringify({application_id:t,terminal:a})})});return n?n.json():{}}async function q(e){return((await v()).quests||[]).find(function(t){return t.id===e})}async function A(e,t){if(c)return;const a=e.config.messages.quest_name,n=e.id,o=e.config.task_config.tasks[t].target;let s=e.user_status?.progress?.[t]?.value||0,u=0;if(i("Y",`${a} type: ${t}`),t.includes("WATCH_VIDEO"))for(;s<o&&!c;){const l=await N(n,Math.min(o,s+7+Math.random()));if(s+=7,Date.now()-u>=1e4&&(i("C",`${a} ${Math.min(s,o)}/${o} remaining ${Math.max(0,o-s)}`),u=Date.now()),l.completed_at)break;await g(2e3)}else{for(;!c;){const l=await b(n,e.config.application.id,!1);if(s=l.progress?.[t]?.value||s,Date.now()-u>=1e4&&(i("C",`${a} ${s}/${o} remaining ${Math.max(0,o-s)}`),u=Date.now()),l.completed_at)break;await g(3e4)}c||await b(n,e.config.application.id,!0)}i("G",`${a} ${t} completed`)}async function C(e){let t=e;for(t.user_status?.enrolled_at||await E(t.id);!(c||(t=await q(t.id),!t||t.user_status?.completed_at));){const a=Object.keys(t.config.task_config.tasks).filter(function(n){const o=t.config.task_config.tasks[n].target;return(t.user_status?.progress?.[n]?.value||0)<o});if(!a.length)break;await A(t,a[0]),await g(3e3)}t&&i("G",`${t.config.messages.quest_name} fully completed`)}async function M(){if(!w()){i("X","Error: No Token found.");return}i("Y","Checking for Quests...");try{const e=((await v()).quests||[]).filter(function(t){return!t.user_status?.completed_at&&new Date(t.config.expires_at)>new Date});if(e.length===0){i("X","No active quests found. Stopping.");return}i("Y",`Found ${e.length} active quests.`);for(const t of e){if(c)break;await C(t)}i("G","All quests finished")}catch(e){i("X",`Error: ${e.message}`)}}var O={onLoad:function(){c=!1,k(),i("C","Auto Quest Plugin Started"),M()},onUnload:function(){c=!0,i("X","Plugin Unloaded.")},settings:S};return _.default=O,Object.defineProperty(_,"__esModule",{value:!0}),_})({},vendetta.metro,vendetta.metro.common);
