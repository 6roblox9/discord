(function(b,i,v,$,R,T,o){"use strict";const _=[];let m=[];function S(u){return m.push(u),function(){m=m.filter(function(t){return t!==u})}}function D(){const[u,t]=o.React.useReducer(function(e){return e+1},0);o.React.useEffect(function(){return S(function(){return t()})},[]);const n=function(e){switch(e){case"G":return"#43b581";case"Y":return"#faa61a";case"C":return"#00b0f4";default:return"#dcddde"}};return o.React.createElement(o.ReactNative.ScrollView,{style:{flex:1,backgroundColor:"#202225",padding:12}},o.React.createElement(o.ReactNative.View,{style:{marginBottom:16}},o.React.createElement(o.ReactNative.Text,{style:{color:"#fff",fontSize:18,fontWeight:"bold",marginBottom:8}},"Quest Auto-Solver Logs")),o.React.createElement(o.ReactNative.View,{style:{backgroundColor:"#2f3136",borderRadius:8,padding:12,minHeight:200}},_.length===0?o.React.createElement(o.ReactNative.Text,{style:{color:"#72767d",fontStyle:"italic",textAlign:"center",marginTop:20}},"Waiting for activity..."):_.map(function(e){return o.React.createElement(o.ReactNative.Text,{key:e.id,style:{fontFamily:"monospace",fontSize:12,marginBottom:2}},o.React.createElement(o.ReactNative.Text,{style:{color:"#72767d"}},"[",e.time,"] "),o.React.createElement(o.ReactNative.Text,{style:{color:n(e.color)}},e.text))})),o.React.createElement(o.ReactNative.View,{style:{height:20}}))}const{getToken:N}=v.findByProps("getToken"),{showSimpleActionSheet:E}=v.findByProps("showSimpleActionSheet");i.storage.logs&&(i.storage.logs=[]);const r=function(u,t=!1){const n=`[${new Date().toLocaleTimeString()}] ${u}`;i.storage.logs||(i.storage.logs=[]),i.storage.logs.unshift(n),i.storage.logs.length>100&&i.storage.logs.pop(),t&&t(u,T.getAssetIDByName("ic_robot_24px")),console.log(n)},A="Discord-Android/305012;RNA",O={os:"Android",browser:"Discord Android",release_channel:"stable",client_version:"305012",os_version:"13",os_arch:"arm64-v8a",system_locale:"en-US",client_build_number:305012,device:"Pixel",manufacturer:"Google",model:"Pixel 7"},h=function(){return Buffer.from(JSON.stringify(O)).toString("base64")};async function p(u,t=3){for(let n=0;n<t;n++)try{return await u()}catch(e){if(n===t-1)throw e;await g(3e3)}throw new Error("Max retries reached")}function g(u){return new Promise(function(t){return setTimeout(t,u)})}async function x(u){return p(function(){return fetch("https://discord.com/api/v10/quests/@me",{headers:{Authorization:u,"User-Agent":A,"x-super-properties":h(),"Content-Type":"application/json"}}).then(function(t){return t.json()})})}async function P(u,t){await p(function(){return fetch(`https://discord.com/api/v10/quests/${t}/enroll`,{method:"POST",headers:{Authorization:u,"User-Agent":A,"x-super-properties":h(),"Content-Type":"application/json"},body:JSON.stringify({location:11,is_targeted:!1,metadata_raw:null})})})}async function B(u,t,n){return p(function(){return fetch(`https://discord.com/api/v10/quests/${t}/video-progress`,{method:"POST",headers:{Authorization:u,"User-Agent":A,"x-super-properties":h(),"Content-Type":"application/json"},body:JSON.stringify({timestamp:n})}).then(function(e){return e.json()})})}async function k(u,t,n,e){return p(function(){return fetch(`https://discord.com/api/v10/quests/${t}/heartbeat`,{method:"POST",headers:{Authorization:u,"User-Agent":A,"x-super-properties":h(),"Content-Type":"application/json"},body:JSON.stringify({application_id:n,terminal:e})}).then(function(a){return a.json()})})}async function j(u,t,n){const e=t.config.messages.quest_name,a=t.id,l=t.config.task_config.tasks[n],d=Object.keys(l)[0],c=l[d].target;let s=t.user_status?.progress?.[n]?.value||0,f=0;if(r(`\u0628\u062F\u0627\u064A\u0629 \u0627\u0644\u0645\u0647\u0645\u0629: ${e} - ${d}`,!0),d.includes("WATCH_VIDEO"))for(;s<c;){const y=await B(u,a,Math.min(c,s+7+Math.random()*3));if(s+=7,Date.now()-f>=1e4&&(r(`${e}: ${Math.min(s,c)}/${c} (\u0645\u062A\u0628\u0642\u064A: ${Math.max(0,c-s)})`),f=Date.now()),y.completed_at)break;await g(2e3+Math.random()*1e3)}else{for(;;){const y=await k(u,a,t.config.application.id,!1);if(s=y.progress?.[n]?.value||s,Date.now()-f>=1e4&&(r(`${e}: ${s}/${c} (\u0645\u062A\u0628\u0642\u064A: ${Math.max(0,c-s)})`),f=Date.now()),y.completed_at)break;await g(3e4+Math.random()*5e3)}await k(u,a,t.config.application.id,!0)}r(`\u0627\u0643\u062A\u0645\u0644\u062A \u0627\u0644\u0645\u0647\u0645\u0629: ${e} - ${d}`,!0)}async function q(u,t){try{const n=t.config.messages.quest_name;for(t.user_status?.enrolled_at||(r(`\u0627\u0644\u062A\u0633\u062C\u064A\u0644 \u0641\u064A \u0627\u0644\u0643\u0648\u064A\u0633\u062A: ${n}`,!0),await P(u,t.id));;){const e=((await x(u)).quests||[]).find(function(l){return l.id===t.id});if(!e||e.user_status?.completed_at){r(`\u0627\u0643\u062A\u0645\u0644 \u0627\u0644\u0643\u0648\u064A\u0633\u062A: ${n}`,!0);break}const a=Object.keys(e.config.task_config.tasks).filter(function(l,d){const c=e.config.task_config.tasks[d],s=Object.keys(c)[0],f=c[s].target;return(e.user_status?.progress?.[d]?.value||0)<f});if(a.length===0)break;await j(u,e,parseInt(a[0])),await g(3e3)}}catch(n){r(`\u062E\u0637\u0623 \u0641\u064A \u0645\u0639\u0627\u0644\u062C\u0629 \u0627\u0644\u0643\u0648\u064A\u0633\u062A: ${n.message}`)}}async function C(){try{const u=N();if(!u){r("\u0641\u0634\u0644 \u0641\u064A \u0627\u0644\u062D\u0635\u0648\u0644 \u0639\u0644\u0649 \u0627\u0644\u062A\u0648\u0643\u0646",!0);return}r("\u062C\u0627\u0631\u064A \u0627\u0644\u0628\u062D\u062B \u0639\u0646 \u0627\u0644\u0643\u0648\u064A\u0633\u062A\u0627\u062A...",!0);const t=((await x(u)).quests||[]).filter(function(n){const e=n.user_status?.completed_at,a=new Date(n.config.expires_at)<=new Date;return!e&&!a});if(t.length===0){r("\u0644\u0627 \u062A\u0648\u062C\u062F \u0643\u0648\u064A\u0633\u062A\u0627\u062A \u0645\u062A\u0627\u062D\u0629 \u062D\u0627\u0644\u064A\u0627\u064B",!0);return}r(`\u062A\u0645 \u0627\u0644\u0639\u062B\u0648\u0631 \u0639\u0644\u0649 ${t.length} \u0643\u0648\u064A\u0633\u062A`,!0);for(const n of t)await q(u,n),await g(5e3);r("\u062A\u0645 \u0625\u0643\u0645\u0627\u0644 \u062C\u0645\u064A\u0639 \u0627\u0644\u0643\u0648\u064A\u0633\u062A\u0627\u062A \u0628\u0646\u062C\u0627\u062D!",!0)}catch(u){r(`\u062E\u0637\u0623: ${u.message}`,!0)}}let w;var M={onLoad(){r("\u062A\u0645 \u062A\u062D\u0645\u064A\u0644 \u0627\u0644\u0628\u0644\u0648\u0642\u0646 \u0628\u0646\u062C\u0627\u062D",!0),setTimeout(function(){C()},1e4),w=R.before("showUserProfile",function(u){const[t]=u;t?.userId||setTimeout(function(){const n=document.querySelectorAll('[class*="headerBar"] button');if(n.length>0){const e=n[n.length-1],a=document.createElement("button");a.innerHTML="\u{1F3AE}",a.style.cssText=`
            background: transparent;
            border: none;
            color: white;
            font-size: 20px;
            padding: 8px;
            cursor: pointer;
            margin-right: 8px;
          `,a.onclick=function(){E({key:"QuestActions",header:{title:"\u0625\u062F\u0627\u0631\u0629 \u0627\u0644\u0643\u0648\u064A\u0633\u062A\u0627\u062A",onClose:function(){}},options:[{label:"\u062A\u0634\u063A\u064A\u0644 \u0627\u0644\u0643\u0648\u064A\u0633\u062A\u0627\u062A \u0627\u0644\u0622\u0646",onPress:function(){return C()}},{label:"\u0639\u0631\u0636 \u0627\u0644\u0633\u062C\u0644\u0627\u062A",onPress:function(){const l=window.open("","_blank");l&&l.document.write(`
                        <html>
                          <head>
                            <title>\u0633\u062C\u0644\u0627\u062A \u0627\u0644\u0643\u0648\u064A\u0633\u062A\u0627\u062A</title>
                            <style>
                              body {
                                background: #36393f;
                                color: white;
                                font-family: sans-serif;
                                padding: 20px;
                              }
                              .log {
                                padding: 8px;
                                border-bottom: 1px solid #444;
                                word-break: break-word;
                              }
                            </style>
                          </head>
                          <body>
                            <h1>\u0633\u062C\u0644\u0627\u062A \u0627\u0644\u0643\u0648\u064A\u0633\u062A\u0627\u062A</h1>
                            <div id="logs"></div>
                            <script>
                              const logs = ${JSON.stringify(i.storage.logs||[])};
                              const container = document.getElementById('logs');
                              logs.forEach(log => {
                                const div = document.createElement('div');
                                div.className = 'log';
                                div.textContent = log;
                                container.appendChild(div);
                              });
                            <\/script>
                          </body>
                        </html>
                      `)}},{label:"\u0645\u0633\u062D \u0627\u0644\u0633\u062C\u0644\u0627\u062A",onPress:function(){i.storage.logs=[],$.showToast("\u062A\u0645 \u0645\u0633\u062D \u0627\u0644\u0633\u062C\u0644\u0627\u062A")}}]})},document.querySelector(".quest-button")||(a.className="quest-button",e.parentNode?.insertBefore(a,e))}},1e3)})},onUnload(){r("\u062A\u0645 \u0625\u064A\u0642\u0627\u0641 \u0627\u0644\u0628\u0644\u0648\u0642\u0646",!0),w&&w(),i.storage.logs=[]},settings:D};return b.default=M,Object.defineProperty(b,"__esModule",{value:!0}),b})({},vendetta.plugin,vendetta.metro,vendetta.ui.toasts,vendetta.patcher,vendetta.ui.assets,vendetta.metro.common);
