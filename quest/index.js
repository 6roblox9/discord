(function(_,m,i){"use strict";const d=[];let f=[];function R(e){return f.push(e),function(){f=f.filter(function(t){return t!==e})}}function r(e,t){const a=new Date().toLocaleTimeString();d.push({id:Math.random().toString(36).substring(7),color:e,text:t,time:a}),f.forEach(function(n){return n()})}function k(){d.length=0,f.forEach(function(e){return e()})}function T(){const[e,t]=i.React.useReducer(function(n){return n+1},0);i.React.useEffect(function(){return R(function(){return t()})},[]);const a=function(n){switch(n){case"G":return"#43b581";case"Y":return"#faa61a";case"C":return"#00b0f4";case"R":return"#f04747";default:return"#dcddde"}};return i.React.createElement(i.ReactNative.ScrollView,{style:{flex:1,backgroundColor:"#202225",padding:12}},i.React.createElement(i.ReactNative.View,{style:{marginBottom:16}},i.React.createElement(i.ReactNative.Text,{style:{color:"#fff",fontSize:18,fontWeight:"bold",marginBottom:8}},"Quest Auto-Solver Logs")),i.React.createElement(i.ReactNative.View,{style:{backgroundColor:"#2f3136",borderRadius:8,padding:12,minHeight:200}},d.length===0?i.React.createElement(i.ReactNative.Text,{style:{color:"#72767d",fontStyle:"italic",textAlign:"center",marginTop:20}},"Waiting for activity..."):d.map(function(n){return i.React.createElement(i.ReactNative.Text,{key:n.id,style:{fontFamily:"monospace",fontSize:12,marginBottom:2}},i.React.createElement(i.ReactNative.Text,{style:{color:"#72767d"}},"[",n.time,"] "),i.React.createElement(i.ReactNative.Text,{style:{color:a(n.color)}},n.text))})),i.React.createElement(i.ReactNative.View,{style:{height:20}}))}const{getToken:w}=m.findByProps("getToken");let c=!1;const y="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) discord/1.0.9215 Chrome/138.0.7204.251 Electron/37.6.0 Safari/537.36",S={os:"Windows",browser:"Discord Client",release_channel:"stable",client_version:"1.0.9215",os_version:"10.0.19045",os_arch:"x64",app_arch:"x64",system_locale:"en-US",has_client_mods:!1,client_launch_id:"80933496-6512-4217-86e5-42289632435f",browser_user_agent:y,browser_version:"37.6.0",os_sdk_version:"19045",client_build_number:471091,native_build_number:72186,client_event_source:null,launch_signature:"80933496-6512-4217-86e5-42289632435f",client_heartbeat_session_id:"80933496-6512-4217-86e5-42289632435f",client_app_state:"focused"},g=function(e){return new Promise(function(t){return setTimeout(t,e)})};function $(e){const t=JSON.stringify(e),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let n="";for(let s=0,o,u=0,l=a;t.charAt(u|0)||(l="=",u%1);n+=l.charAt(63&s>>8-u%1*8)){if(o=t.charCodeAt(u+=3/4),o>255)throw new Error("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");s=s<<8|o}return n}function h(){return{Authorization:w(),"User-Agent":y,"x-super-properties":$(S),"Content-Type":"application/json"}}async function p(e,t=5){for(let a=0;a<t;a++){if(c)return null;try{return await e()}catch{await g(3e3)}}throw new Error("Request failed after retries")}async function v(){const e=await p(function(){return fetch("https://discord.com/api/v9/quests/@me",{headers:h()})});return e?e.json():{quests:[]}}async function x(e){await p(function(){return fetch(`https://discord.com/api/v9/quests/${e}/enroll`,{method:"POST",headers:h(),body:JSON.stringify({location:11,is_targeted:!1,metadata_raw:null})})})}async function E(e,t){const a=await p(function(){return fetch(`https://discord.com/api/v9/quests/${e}/video-progress`,{method:"POST",headers:h(),body:JSON.stringify({timestamp:t})})});return a?a.json():{}}async function b(e,t,a){const n=await p(function(){return fetch(`https://discord.com/api/v9/quests/${e}/heartbeat`,{method:"POST",headers:h(),body:JSON.stringify({application_id:t,terminal:a})})});return n?n.json():{}}async function N(e){return((await v()).quests||[]).find(function(t){return t.id===e})}async function q(e,t){if(c)return;const a=e.config.messages.quest_name,n=e.id,s=e.config.task_config.tasks[t].target;let o=e.user_status?.progress?.[t]?.value||0,u=0;if(r("Y",`${a} type: ${t}`),t.includes("WATCH_VIDEO"))for(;o<s&&!c;){const l=7+Math.random(),D=Math.min(s,o+l),M=await E(n,D);if(o+=7,Date.now()-u>=1e4&&(r("C",`${a} ${Math.min(o,s).toFixed(0)}/${s} remaining ${Math.max(0,s-o).toFixed(0)}`),u=Date.now()),M.completed_at)break;await g(2e3)}else{for(;!c;){const l=await b(n,e.config.application.id,!1);if(o=l.progress?.[t]?.value||o,Date.now()-u>=1e4&&(r("C",`${a} ${o}/${s} remaining ${Math.max(0,s-o)}`),u=Date.now()),l.completed_at)break;await g(3e4)}c||await b(n,e.config.application.id,!0)}r("G",`${a} ${t} completed`)}async function C(e){let t=e;for(t.user_status?.enrolled_at||await x(t.id);!(c||(t=await N(t.id),!t||t.user_status?.completed_at));){const a=Object.keys(t.config.task_config.tasks).filter(function(n){const s=t.config.task_config.tasks[n].target;return(t.user_status?.progress?.[n]?.value||0)<s});if(!a.length)break;await q(t,a[0]),await g(3e3)}t&&r("G",`${t.config.messages.quest_name} fully completed`)}async function A(){if(!w()){r("X","Error: No Token found.");return}r("Y","Checking for Quests...");try{const e=((await v()).quests||[]).filter(function(t){return!t.user_status?.completed_at&&new Date(t.config.expires_at)>new Date});if(e.length===0){r("X","No active quests found. Stopping.");return}r("Y",`Found ${e.length} active quests.`);for(const t of e){if(c)break;await C(t)}r("G","All quests finished")}catch(e){r("X",`Error: ${e.message}`)}}var O={onLoad:function(){c=!1,k(),r("C","Auto Quest Plugin Started"),A()},onUnload:function(){c=!0,r("X","Plugin Unloaded.")},settings:T};return _.default=O,Object.defineProperty(_,"__esModule",{value:!0}),_})({},vendetta.metro,vendetta.metro.common);
