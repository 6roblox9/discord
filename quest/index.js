(function(_,m,n){"use strict";const l=[];let u=[];function R(e){return u.push(e),function(){u=u.filter(function(t){return t!==e})}}function r(e,t){const i=new Date().toLocaleTimeString();l.push({id:Math.random().toString(36).substring(7),color:e,text:t,time:i}),u.forEach(function(a){return a()})}function k(){l.length=0,u.forEach(function(e){return e()})}function S(){const[e,t]=n.React.useReducer(function(a){return a+1},0);n.React.useEffect(function(){return R(function(){return t()})},[]);const i=function(a){switch(a){case"G":return"#43b581";case"Y":return"#faa61a";case"C":return"#00b0f4";default:return"#dcddde"}};return n.React.createElement(n.ReactNative.ScrollView,{style:{flex:1,backgroundColor:"#202225",padding:12}},n.React.createElement(n.ReactNative.View,{style:{marginBottom:16}},n.React.createElement(n.ReactNative.Text,{style:{color:"#fff",fontSize:18,fontWeight:"bold",marginBottom:8}},"Quest Auto-Solver Logs")),n.React.createElement(n.ReactNative.View,{style:{backgroundColor:"#2f3136",borderRadius:8,padding:12,minHeight:200}},l.length===0?n.React.createElement(n.ReactNative.Text,{style:{color:"#72767d",fontStyle:"italic",textAlign:"center",marginTop:20}},"Waiting for activity..."):l.map(function(a){return n.React.createElement(n.ReactNative.Text,{key:a.id,style:{fontFamily:"monospace",fontSize:12,marginBottom:2}},n.React.createElement(n.ReactNative.Text,{style:{color:"#72767d"}},"[",a.time,"] "),n.React.createElement(n.ReactNative.Text,{style:{color:i(a.color)}},a.text))})),n.React.createElement(n.ReactNative.View,{style:{height:20}}))}const{getToken:y}=m.findByProps("getToken");let s=!1;const w="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) discord/1.0.9215 Chrome/138.0.7204.251 Electron/37.6.0 Safari/537.36";function x(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const t=Math.random()*16|0;return(e==="x"?t:t&3|8).toString(16)})}const $={os:"Windows",browser:"Discord Client",release_channel:"stable",client_version:"1.0.9215",os_version:"10.0.19045",os_arch:"x64",app_arch:"x64",system_locale:"en-US",has_client_mods:!1,client_launch_id:x(),browser_user_agent:w,browser_version:"37.6.0",os_sdk_version:"19045",client_build_number:471091,native_build_number:72186,client_event_source:null,launch_signature:x(),client_heartbeat_session_id:x(),client_app_state:"focused"},f=function(e){return new Promise(function(t){return setTimeout(t,e)})};function d(e=!1){const t={Authorization:y(),"User-Agent":w,"x-super-properties":btoa(JSON.stringify($))};return e&&(t["Content-Type"]="application/json"),t}async function g(e,t=5){for(let i=0;i<t;i++){if(s)return null;try{return await e()}catch{await f(3e3)}}throw new Error("Request failed after retries")}async function v(){const e=await g(function(){return fetch("https://discord.com/api/v10/quests/@me",{headers:d()})});return e?e.json():{quests:[]}}async function T(e){await g(function(){return fetch(`https://discord.com/api/v10/quests/${e}/enroll`,{method:"POST",headers:d(!0),body:JSON.stringify({location:11,is_targeted:!1,metadata_raw:null})})})}async function E(e,t){const i=await g(function(){return fetch(`https://discord.com/api/v10/quests/${e}/video-progress`,{method:"POST",headers:d(!0),body:JSON.stringify({timestamp:t})})});return i?i.json():{}}async function b(e,t,i){const a=await g(function(){return fetch(`https://discord.com/api/v10/quests/${e}/heartbeat`,{method:"POST",headers:d(!0),body:JSON.stringify({application_id:t,terminal:i})})});return a?a.json():{}}async function N(e){return((await v()).quests||[]).find(function(t){return t.id===e})}async function q(e,t){if(s)return;const i=e.config.messages.quest_name,a=e.id,o=e.config.task_config.tasks[t].target;let c=e.user_status?.progress?.[t]?.value||0,h=0;if(r("Y",`${i} type: ${t}`),t.includes("WATCH_VIDEO"))for(;c<o&&!s;){const p=await E(a,Math.min(o,c+7+Math.random()));if(c+=7,Date.now()-h>=1e4&&(r("C",`${i} ${Math.min(c,o)}/${o} remaining ${Math.max(0,o-c)}`),h=Date.now()),p.completed_at)break;await f(2e3)}else{for(;!s;){const p=await b(a,e.config.application.id,!1);if(c=p.progress?.[t]?.value||c,Date.now()-h>=1e4&&(r("C",`${i} ${c}/${o} remaining ${Math.max(0,o-c)}`),h=Date.now()),p.completed_at)break;await f(3e4)}s||await b(a,e.config.application.id,!0)}r("G",`${i} ${t} completed`)}async function C(e){let t=e;for(t.user_status?.enrolled_at||await T(t.id);!(s||(t=await N(t.id),!t||t.user_status?.completed_at));){const i=Object.keys(t.config.task_config.tasks).filter(function(a){const o=t.config.task_config.tasks[a].target;return(t.user_status?.progress?.[a]?.value||0)<o});if(!i.length)break;await q(t,i[0]),await f(3e3)}t&&r("G",`${t.config.messages.quest_name} fully completed`)}async function M(){if(!y()){r("X","Error: No Token found.");return}r("Y","Checking for Quests...");try{const e=((await v()).quests||[]).filter(function(t){return!t.user_status?.completed_at&&new Date(t.config.expires_at)>new Date});if(e.length===0){r("X","No active quests found. Stopping.");return}r("Y",`Found ${e.length} active quests.`);for(const t of e){if(s)break;await C(t)}r("G","All quests finished")}catch(e){r("X",`Error: ${e.message}`)}}var O={onLoad:function(){s=!1,k(),r("C","Auto Quest Plugin Started"),M()},onUnload:function(){s=!0,r("X","Plugin Unloaded.")},settings:S};return _.default=O,Object.defineProperty(_,"__esModule",{value:!0}),_})({},vendetta.metro,vendetta.metro.common);
