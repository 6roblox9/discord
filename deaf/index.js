(function(s,l,u,o){"use strict";const p=u.findByProps("getCurrentUser"),i=u.findByProps("getAPIBaseURL","patch","post"),w=u.findByProps("uploadFile");function c(a,n){return a.find(function(e){return e.name===n})?.value}async function m(a,n){await i.post({url:`/channels/${a}/messages`,body:{content:n}})}async function d(a){const n=await fetch(a);if(!n.ok)throw new Error("Failed to fetch JSON");return await n.json()}async function f(a,n){const e=new Blob([JSON.stringify(n,null,2)],{type:"application/json"});await w.upload({channelId:a,file:e,filename:"profile.json"})}async function b(a){await i.patch({url:"/users/@me",body:{username:a.username,global_name:a.global_name,bio:a.bio,pronouns:a.pronouns}}),"avatar"in a&&await i.patch({url:"/users/@me",body:{avatar:a.avatar}}),"banner"in a&&await i.patch({url:"/users/@me",body:{banner:a.banner}})}function h(){const a=p.getCurrentUser();return{username:a.username,global_name:a.globalName,bio:a.bio,pronouns:a.pronouns,avatar:a.avatar,banner:a.banner}}var y={onLoad(){l.registerCommand({name:"profile",description:"Save / Load profile",options:[{name:"action",type:3,required:!0},{name:"link",type:3,required:!1}],execute:async function(a,n){try{const e=c(a,"action")?.toLowerCase(),r=c(a,"link");if(e==="save"&&!r){const t=h();await f(n.channel.id,t),o.showToast("Profile saved");return}if(e==="load"&&r){const t=await d(r);await b(t),o.showToast("Profile loaded");return}if(e==="save"&&r){const t=await d(r);await f(n.channel.id,t),o.showToast("JSON sent");return}throw new Error("Invalid arguments")}catch(e){await m(n.channel.id,`\u274C Error: ${e.message}`),o.showToast("Profile error")}}})},onUnload(){l.unregisterAllCommands()}};return s.default=y,Object.defineProperty(s,"__esModule",{value:!0}),s})({},vendetta.commands,vendetta.metro,vendetta.ui.toasts);
