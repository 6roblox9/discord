(function(s,l,u,t){"use strict";const f=u.findByProps("getCurrentUser"),i=u.findByProps("getAPIBaseURL","patch","post"),p=u.findByProps("uploadFile");async function w(a,n){await i.post({url:`/channels/${a}/messages`,body:{content:n}})}async function c(a){const n=await fetch(a);if(!n.ok)throw new Error("Failed to fetch JSON");return await n.json()}async function d(a,n){const e=new Blob([JSON.stringify(n,null,2)],{type:"application/json"});await p.upload({channelId:a,file:e,filename:"profile.json"})}async function m(a){await i.patch({url:"/users/@me",body:{username:a.username,global_name:a.global_name,bio:a.bio,pronouns:a.pronouns}}),"avatar"in a&&await i.patch({url:"/users/@me",body:{avatar:a.avatar}}),"banner"in a&&await i.patch({url:"/users/@me",body:{banner:a.banner}})}function b(){const a=f.getCurrentUser();return{username:a.username,global_name:a.globalName,bio:a.bio,pronouns:a.pronouns,avatar:a.avatar,banner:a.banner}}var h={onLoad(){l.registerCommand({name:"profile",description:"Save / Load profile",options:[{name:"action",type:3,required:!0},{name:"link",type:3,required:!1}],execute:async function(a,n){try{const e=a.action?.value?.toLowerCase(),o=a.link?.value;if(e==="save"&&!o){const r=b();await d(n.channel.id,r),t.showToast("Profile saved");return}if(e==="load"&&o){const r=await c(o);await m(r),t.showToast("Profile loaded");return}if(e==="save"&&o){const r=await c(o);await d(n.channel.id,r),t.showToast("JSON sent");return}throw new Error("Invalid arguments")}catch(e){await w(n.channel.id,`\u274C Error: ${e.message}`),t.showToast("Profile error")}}})},onUnload(){l.unregisterAllCommands()}};return s.default=h,Object.defineProperty(s,"__esModule",{value:!0}),s})({},vendetta.commands,vendetta.metro,vendetta.ui.toasts);
